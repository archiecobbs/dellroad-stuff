<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Synchronizer (DellRoad Stuff 2.2.2 API)</title>
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="Synchronizer (DellRoad Stuff 2.2.2 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10,"i10":10,"i11":10,"i12":10,"i13":10,"i14":10,"i15":10,"i16":10,"i17":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/Synchronizer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/dellroad/stuff/pobj/distrib/MergeStrategy.html" title="enum in org.dellroad.stuff.pobj.distrib"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li>Next&nbsp;Class</li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/dellroad/stuff/pobj/distrib/Synchronizer.html" target="_top">Frames</a></li>
<li><a href="Synchronizer.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.dellroad.stuff.pobj.distrib</div>
<h2 title="Class Synchronizer" class="title">Class Synchronizer&lt;T&gt;</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li><a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html" title="class in org.dellroad.stuff.spring">org.dellroad.stuff.spring.AbstractBean</a></li>
<li>
<ul class="inheritance">
<li>org.dellroad.stuff.pobj.distrib.Synchronizer&lt;T&gt;</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt><span class="paramLabel">Type Parameters:</span></dt>
<dd><code>T</code> - type of the root object</dd>
</dl>
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectListener.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectListener</a>&lt;T&gt;, org.springframework.beans.factory.DisposableBean, org.springframework.beans.factory.InitializingBean</dd>
</dl>
<hr>
<br>
<pre>public class <span class="typeNameLabel">Synchronizer&lt;T&gt;</span>
extends <a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html" title="class in org.dellroad.stuff.spring">AbstractBean</a>
implements <a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectListener.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectListener</a>&lt;T&gt;</pre>
<div class="block">Synchronizes a <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> database across multiple nodes using <code>git(1)</code>.

 <p>
 This class provides a simple and lightweight way to build a "master-master" multi-node database
 based on <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> object graphs. The basic idea is to apply <code>git(1)</code>'s
 efficient communication protocol and powerful merging algorithms to the <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a>
 database's XML representation. As a result, all nodes can make simultaneous changes, updates are
 communicated quickly, and in only a small corner case -- two conflicting changes to the same
 data element applied at virtually same time -- must one node's change "win" and the other's "lose".
 No global communication or two-phase commit protocol is required, and recovery from arbitrary
 network problems is automatic.

 <p>
 This class works by registering as a <a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectListener.html" title="interface in org.dellroad.stuff.pobj">listener</a> on a <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a>
 and also managing a private <code>git(1)</code> repository which is configured to track zero or more remotes.
 Each time a change occurs to the <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> database, an updated XML copy of the database
 is committed to the <code>git(1)</code> repository, and then <i>synchronization</i> is performed: all remotes are fetched
 and their corresponding <code>git(1)</code> branches merged into the local <code>git(1)</code> branch (this process
 is performed by <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#synchronize--"><code>synchronize()</code></a>). During synchronization, several merge strategies are tried until an XML file
 is produced that <a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html#validate-T-">validates</a>.
 If synchronization results in a non-trivial merge (i.e., any changes), the local <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> is updated
 with the result and therefore made aware of the other nodes' changes. In this way, all nodes have their
 <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> databases automatically synchronized and merged as they evolve.

 <p>
 The user of this class must separately initialize each node's <code>git(1)</code> repository, configure the
 <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setRemotes-java.util.List-">remotes</a>, and determine when to <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#synchronize--"><code>synchronize()</code></a> remote changes:
 as mentioned above, synchronization is performed automatically when the local <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> database changes,
 but for remote changes either some external notification process must trigger a call to <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#synchronize--"><code>synchronize()</code></a>,
 or <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#synchronize--"><code>synchronize()</code></a> must be invoked at regular intervals, or (for robustness in the face of transient
 network issues) both.

 <p>
 Merges are handled by <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#merge-java.lang.String-java.lang.String-java.lang.String-java.lang.String-"><code>merge()</code></a> (which subclasses may override if desired). The <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#merge-java.lang.String-java.lang.String-java.lang.String-java.lang.String-"><code>merge</code></a>
 implementation in this class attempts merges using the following strategies in order until there are no merge
 conflicts and a <a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html#validate-T-">valid</a> XML file is achieved:
  <ul>
  <li>Recursive merge using the patience algorithm</li>
  <li>Same as previous, but resolving all conflicts one way or the other</li>
  <li>Simply choosing one file or the other</li>
  </ul>

 <p>
 If conflicts occur in attempt #1, but attempt #2 or #3 succeeds and the other node is the "winner", then
 <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#handleConflictOverride-java.lang.String-java.lang.String-java.lang.String-org.dellroad.stuff.pobj.distrib.MergeStrategy-"><code>handleConflictOverride()</code></a> is invoked to notify the local node that some of
 its recent changes have been overridden; if all three attempts fail, then
 <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#handleImpossibleMerge-java.lang.String-java.lang.String-java.lang.String-"><code>handleImpossibleMerge()</code></a> is invoked and we stay with whatever version we are on;
 this latter case can only occur when another node is running a different version of the software
 (with different validation criteria).

 <p>
 For attempts #2 and #3, the "winner" is chosen by <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#chooseConflictWinner-java.lang.String-java.lang.String-"><code>chooseConflictWinner()</code></a> as follows:
  <ul>
  <li>If the commits have different timestamps, then the later commit wins</li>
  <li>If the two commits were simultaneous, then the commit with the lexicographically higher SHA-1 checksum wins</li>
  <li>If the two commits have the same timestamp and SHA-1 checksum, then there won't be any conflicts :)</li>
  </ul>

 <p>
 Subclasses may <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#chooseConflictWinner-java.lang.String-java.lang.String-">override how the winner is chosen</a>.

 <p>
 Because all nodes follow this same algorithm for merging, they will all end up with the same result
 (note however that the <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> object graph must serialize in a deterministic way for this to be true).

 <p>
 Note that merge conflicts can only happen when two nodes make changes at virtually the same time (or, when
 separated by a network partition): i.e., a change on one node occurs within the window of time after a change
 is made on another node but before the first node is notified and synchronizes. Using a simple
 real-time notification process, this window can be kept small, especially relative to the frequent-read,
 infrequent-write access pattern that the <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> class is designed for. When a conflict override
 does occur, subclasses can override <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#handleConflictOverride-java.lang.String-java.lang.String-java.lang.String-org.dellroad.stuff.pobj.distrib.MergeStrategy-"><code>handleConflictOverride()</code></a> to take appropriate action.

 <p>
 Instances of this class are thread safe.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#branch">branch</a></span></code>
<div class="block">The name for the <code>git(1)</code> branches we manage.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#DEFAULT_BRANCH">DEFAULT_BRANCH</a></span></code>
<div class="block">Default value for the <code>git(1)</code> <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setBranch-java.lang.String-">branch</a> name ("master").</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#DEFAULT_FILENAME">DEFAULT_FILENAME</a></span></code>
<div class="block">Default value for the XML file that is stored in the <code>git(1)</code> repository ("root.xml").</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#filename">filename</a></span></code>
<div class="block">The name of our XML file in the <code>git(1)</code> repository.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="../../../../../org/dellroad/stuff/pobj/distrib/GitRepository.html" title="class in org.dellroad.stuff.pobj.distrib">GitRepository</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#git">git</a></span></code>
<div class="block">Our associated <code>git(1)</code> repository.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj">PersistentObject</a>&lt;<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#persistentObject">persistentObject</a></span></code>
<div class="block">The associated <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#remotes">remotes</a></span></code>
<div class="block">The names of the <code>git(1)</code> remotes we should synchronize with.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="fields.inherited.from.class.org.dellroad.stuff.spring.AbstractBean">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;org.dellroad.stuff.spring.<a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html" title="class in org.dellroad.stuff.spring">AbstractBean</a></h3>
<code><a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html#log">log</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#Synchronizer--">Synchronizer</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#afterPropertiesSet--">afterPropertiesSet</a></span>()</code>
<div class="block">Initialize bean.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#applyLocalUpdate-org.dellroad.stuff.pobj.PersistentObject.Snapshot-java.lang.String-">applyLocalUpdate</a></span>(<a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.Snapshot.html" title="class in org.dellroad.stuff.pobj">PersistentObject.Snapshot</a>&nbsp;snapshot,
                <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commitMessage)</code>
<div class="block">Given a (possibly) updated local root, <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#commit-T-java.lang.String-">commit</a> it to our local branch,
 <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#synchronize--"><code>synchronize()</code></a> with our peers if it represented a change, and apply the newly merged
 root (if any) back to the associated <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a>.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#chooseConflictWinner-java.lang.String-java.lang.String-">chooseConflictWinner</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commit1,
                    <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commit2)</code>
<div class="block">Choose which commit should "win" in case there is a conflict between two commits.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>protected <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#commit-T-java.lang.String-">commit</a></span>(<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&nbsp;root,
      <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commitMessage)</code>
<div class="block">Commit the given root to our <code>git(1)</code> repository.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#destroy--">destroy</a></span>()</code>
<div class="block">Shutdown bean.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#getCommittedRoot--">getCommittedRoot</a></span>()</code>
<div class="block">Read the persistent object root value that is currently committed to our local branch.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>protected <a href="http://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#getXMLFile-java.io.File-">getXMLFile</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dir)</code>
<div class="block">Get the XML file.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#handleConflictOverride-java.lang.String-java.lang.String-java.lang.String-org.dellroad.stuff.pobj.distrib.MergeStrategy-">handleConflictOverride</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remote,
                      <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;localCommit,
                      <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remoteCommit,
                      <a href="../../../../../org/dellroad/stuff/pobj/distrib/MergeStrategy.html" title="enum in org.dellroad.stuff.pobj.distrib">MergeStrategy</a>&nbsp;strategy)</code>
<div class="block">Handle a situation where some of our local changes were overridden due to merge conflicts, but
 in the end we were able to produce a valid root.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#handleEvent-org.dellroad.stuff.pobj.PersistentObjectEvent-">handleEvent</a></span>(<a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectEvent.html" title="class in org.dellroad.stuff.pobj">PersistentObjectEvent</a>&lt;<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&gt;&nbsp;event)</code>
<div class="block">Handle notification of a change to the local root.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#handleImpossibleMerge-java.lang.String-java.lang.String-java.lang.String-">handleImpossibleMerge</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remote,
                     <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;localCommit,
                     <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remoteCommit)</code>
<div class="block">Handle a situation where all of the merge strategies failed to produce a valid root object.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>protected <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#merge-java.lang.String-java.lang.String-java.lang.String-java.lang.String-">merge</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remote,
     <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;localCommit,
     <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remoteCommit,
     <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commitBranch)</code>
<div class="block">Attempt to merge a local and remote commit and commit the result to the specified branch.</div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code>protected <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#readXMLFile-java.io.File-boolean-">readXMLFile</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dir,
           boolean&nbsp;validate)</code>
<div class="block">Read and (optionally) validate the XML file.</div>
</td>
</tr>
<tr id="i12" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setBranch-java.lang.String-">setBranch</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;branch)</code>
<div class="block">Configure name of the <code>git(1)</code> branches we will manage.</div>
</td>
</tr>
<tr id="i13" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setFilename-java.lang.String-">setFilename</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename)</code>
<div class="block">Configure the name of the XML file in the <code>git(1)</code> repository.</div>
</td>
</tr>
<tr id="i14" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setGitRepository-org.dellroad.stuff.pobj.distrib.GitRepository-">setGitRepository</a></span>(<a href="../../../../../org/dellroad/stuff/pobj/distrib/GitRepository.html" title="class in org.dellroad.stuff.pobj.distrib">GitRepository</a>&nbsp;git)</code>
<div class="block">Configure the <code>git(1)</code> repository location.</div>
</td>
</tr>
<tr id="i15" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setPersistentObject-org.dellroad.stuff.pobj.PersistentObject-">setPersistentObject</a></span>(<a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj">PersistentObject</a>&lt;<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&gt;&nbsp;persistentObject)</code>
<div class="block">Configure the <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> that this instance will interact with.</div>
</td>
</tr>
<tr id="i16" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setRemotes-java.util.List-">setRemotes</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt;&nbsp;remotes)</code>
<div class="block">Configure the names of the <code>git(1)</code> remotes we will synchronize with.</div>
</td>
</tr>
<tr id="i17" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#synchronize--">synchronize</a></span>()</code>
<div class="block">Synchronize what we have previously committed with our peers' latest information.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="DEFAULT_FILENAME">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DEFAULT_FILENAME</h4>
<pre>public static final&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> DEFAULT_FILENAME</pre>
<div class="block">Default value for the XML file that is stored in the <code>git(1)</code> repository ("root.xml").</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.dellroad.stuff.pobj.distrib.Synchronizer.DEFAULT_FILENAME">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DEFAULT_BRANCH">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DEFAULT_BRANCH</h4>
<pre>public static final&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> DEFAULT_BRANCH</pre>
<div class="block">Default value for the <code>git(1)</code> <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setBranch-java.lang.String-">branch</a> name ("master").</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.dellroad.stuff.pobj.distrib.Synchronizer.DEFAULT_BRANCH">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="persistentObject">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>persistentObject</h4>
<pre>protected&nbsp;<a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj">PersistentObject</a>&lt;<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&gt; persistentObject</pre>
<div class="block">The associated <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a>.</div>
</li>
</ul>
<a name="git">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>git</h4>
<pre>protected&nbsp;<a href="../../../../../org/dellroad/stuff/pobj/distrib/GitRepository.html" title="class in org.dellroad.stuff.pobj.distrib">GitRepository</a> git</pre>
<div class="block">Our associated <code>git(1)</code> repository.</div>
</li>
</ul>
<a name="filename">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>filename</h4>
<pre>protected&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> filename</pre>
<div class="block">The name of our XML file in the <code>git(1)</code> repository.</div>
</li>
</ul>
<a name="branch">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>branch</h4>
<pre>protected&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> branch</pre>
<div class="block">The name for the <code>git(1)</code> branches we manage.</div>
</li>
</ul>
<a name="remotes">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>remotes</h4>
<pre>protected&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt; remotes</pre>
<div class="block">The names of the <code>git(1)</code> remotes we should synchronize with.</div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="Synchronizer--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>Synchronizer</h4>
<pre>public&nbsp;Synchronizer()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="setPersistentObject-org.dellroad.stuff.pobj.PersistentObject-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setPersistentObject</h4>
<pre>public&nbsp;void&nbsp;setPersistentObject(<a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj">PersistentObject</a>&lt;<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&gt;&nbsp;persistentObject)</pre>
<div class="block">Configure the <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> that this instance will interact with.

 <p>
 Required property.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>persistentObject</code> - the persistent object to sync</dd>
</dl>
</li>
</ul>
<a name="setGitRepository-org.dellroad.stuff.pobj.distrib.GitRepository-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setGitRepository</h4>
<pre>public&nbsp;void&nbsp;setGitRepository(<a href="../../../../../org/dellroad/stuff/pobj/distrib/GitRepository.html" title="class in org.dellroad.stuff.pobj.distrib">GitRepository</a>&nbsp;git)</pre>
<div class="block">Configure the <code>git(1)</code> repository location. The repository, branches, and remotes must already exist.

 <p>
 Note that multiple instances of this class can share the same <a href="../../../../../org/dellroad/stuff/pobj/distrib/GitRepository.html" title="class in org.dellroad.stuff.pobj.distrib"><code>GitRepository</code></a> as long as they
 are configured with different <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setBranch-java.lang.String-">branches</a>.

 <p>
 Required property.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>git</code> - <code>git(1)</code> repository</dd>
</dl>
</li>
</ul>
<a name="setFilename-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setFilename</h4>
<pre>public&nbsp;void&nbsp;setFilename(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename)</pre>
<div class="block">Configure the name of the XML file in the <code>git(1)</code> repository.

 <p>
 Default value is <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#DEFAULT_FILENAME">"root.xml"</a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>filename</code> - XML file name</dd>
</dl>
</li>
</ul>
<a name="setBranch-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setBranch</h4>
<pre>public&nbsp;void&nbsp;setBranch(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;branch)</pre>
<div class="block">Configure name of the <code>git(1)</code> branches we will manage.

 <p>
 The same branch name is used for all nodes in the cluster, local and remote, so
 this name identifes both the local branch representing this node's root and each
 remote's branch that we track and merge from.

 <p>
 Value must match <a href="../../../../../org/dellroad/stuff/pobj/distrib/GitRepository.html#BRANCH_NAME_PATTERN"><code>GitRepository.BRANCH_NAME_PATTERN</code></a>.

 <p>
 Default value is <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#DEFAULT_BRANCH">"master"</a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>branch</code> - branch name</dd>
</dl>
</li>
</ul>
<a name="setRemotes-java.util.List-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setRemotes</h4>
<pre>public&nbsp;void&nbsp;setRemotes(<a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt;&nbsp;remotes)</pre>
<div class="block">Configure the names of the <code>git(1)</code> remotes we will synchronize with.
 Note: these are <code>git(1)</code> remote names, not <code>git(1)</code> branch names; the same
 <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#setBranch-java.lang.String-">branch</a> is used for all nodes in the cluster, local and remote.

 <p>
 Each value must match <a href="../../../../../org/dellroad/stuff/pobj/distrib/GitRepository.html#REMOTE_NAME_PATTERN"><code>GitRepository.REMOTE_NAME_PATTERN</code></a>.

 <p>
 Required property.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>remotes</code> - names of git remotes</dd>
</dl>
</li>
</ul>
<a name="afterPropertiesSet--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>afterPropertiesSet</h4>
<pre>public&nbsp;void&nbsp;afterPropertiesSet()
                        throws <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from class:&nbsp;<code><a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html#afterPropertiesSet--">AbstractBean</a></code></span></div>
<div class="block">Initialize bean.

 <p>
 The implementation in <a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html" title="class in org.dellroad.stuff.spring"><code>AbstractBean</code></a> does nothing.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code>afterPropertiesSet</code>&nbsp;in interface&nbsp;<code>org.springframework.beans.factory.InitializingBean</code></dd>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code><a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html#afterPropertiesSet--">afterPropertiesSet</a></code>&nbsp;in class&nbsp;<code><a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html" title="class in org.dellroad.stuff.spring">AbstractBean</a></code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd>
</dl>
</li>
</ul>
<a name="destroy--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>destroy</h4>
<pre>public&nbsp;void&nbsp;destroy()
             throws <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from class:&nbsp;<code><a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html#destroy--">AbstractBean</a></code></span></div>
<div class="block">Shutdown bean.

 <p>
 The implementation in <a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html" title="class in org.dellroad.stuff.spring"><code>AbstractBean</code></a> does nothing.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code>destroy</code>&nbsp;in interface&nbsp;<code>org.springframework.beans.factory.DisposableBean</code></dd>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code><a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html#destroy--">destroy</a></code>&nbsp;in class&nbsp;<code><a href="../../../../../org/dellroad/stuff/spring/AbstractBean.html" title="class in org.dellroad.stuff.spring">AbstractBean</a></code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd>
</dl>
</li>
</ul>
<a name="handleEvent-org.dellroad.stuff.pobj.PersistentObjectEvent-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>handleEvent</h4>
<pre>public&nbsp;void&nbsp;handleEvent(<a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectEvent.html" title="class in org.dellroad.stuff.pobj">PersistentObjectEvent</a>&lt;<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&gt;&nbsp;event)</pre>
<div class="block">Handle notification of a change to the local root.

 <p>
 The implementation in <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="class in org.dellroad.stuff.pobj.distrib"><code>Synchronizer</code></a> delegates to <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#applyLocalUpdate-org.dellroad.stuff.pobj.PersistentObject.Snapshot-java.lang.String-"><code>applyLocalUpdate(org.dellroad.stuff.pobj.PersistentObject&lt;T&gt;.Snapshot, java.lang.String)</code></a>.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectListener.html#handleEvent-org.dellroad.stuff.pobj.PersistentObjectEvent-">handleEvent</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectListener.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectListener</a>&lt;<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&gt;</code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>event</code> - notification event</dd>
</dl>
</li>
</ul>
<a name="applyLocalUpdate-org.dellroad.stuff.pobj.PersistentObject.Snapshot-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>applyLocalUpdate</h4>
<pre>protected&nbsp;void&nbsp;applyLocalUpdate(<a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.Snapshot.html" title="class in org.dellroad.stuff.pobj">PersistentObject.Snapshot</a>&nbsp;snapshot,
                                <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commitMessage)</pre>
<div class="block">Given a (possibly) updated local root, <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#commit-T-java.lang.String-">commit</a> it to our local branch,
 <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#synchronize--"><code>synchronize()</code></a> with our peers if it represented a change, and apply the newly merged
 root (if any) back to the associated <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a>.

 <p>
 This method is invoked at <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#afterPropertiesSet--">startup</a> and after <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#handleEvent-org.dellroad.stuff.pobj.PersistentObjectEvent-">notification</a>
 of each local change.

 <p>
 This method does nothing if the root is null.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>snapshot</code> - snapshot containing new root (possibly null) and its version</dd>
<dd><code>commitMessage</code> - message for the commit</dd>
</dl>
</li>
</ul>
<a name="getCommittedRoot--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCommittedRoot</h4>
<pre>public&nbsp;<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&nbsp;getCommittedRoot()</pre>
<div class="block">Read the persistent object root value that is currently committed to our local branch.
 This method can be used after a positive result from <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#synchronize--"><code>synchronize()</code></a> to access the
 updated root.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>committed root</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../org/dellroad/stuff/pobj/PersistentObjectException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectException</a></code> - if the committed root cannot be read</dd>
</dl>
</li>
</ul>
<a name="commit-java.lang.Object-java.lang.String-">
<!--   -->
</a><a name="commit-T-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>commit</h4>
<pre>protected&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commit(<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&nbsp;root,
                        <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commitMessage)</pre>
<div class="block">Commit the given root to our <code>git(1)</code> repository.

 <p>
 If the local branch does not already exist, it will be created.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>root</code> - persistent object root</dd>
<dd><code>commitMessage</code> - message for the commit</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>new commit ID if commit occurred, or null if <code>root</code> was identical to the already-committed head of our branch</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>root</code> is null</dd>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>commitMessage</code> is null</dd>
</dl>
</li>
</ul>
<a name="synchronize--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>synchronize</h4>
<pre>public&nbsp;boolean&nbsp;synchronize()</pre>
<div class="block">Synchronize what we have previously committed with our peers' latest information.

 <p>
 This method fetches the configured remotes and then merges them into our local branch,
 ensuring that the merge always yeilds a root that validates. If the fetch fails for
 one or more remotes, an error is logged and synchronization proceeds anyway.

 <p>
 If the local branch does not already exist, it will be created.

 <p>
 This method does not affect the <a href="../../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="class in org.dellroad.stuff.pobj"><code>PersistentObject</code></a> associated with this instance;
 the caller is responsible for doing that if necessary (i.e., when true is returned).

 <p>
 This method delegates to <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#merge-java.lang.String-java.lang.String-java.lang.String-java.lang.String-"><code>merge</code></a> to do the actual merging.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true if one or more non-trivial merges ocurred, false if we were already up-to-date</dd>
</dl>
</li>
</ul>
<a name="merge-java.lang.String-java.lang.String-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>merge</h4>
<pre>protected&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;merge(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remote,
                       <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;localCommit,
                       <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remoteCommit,
                       <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commitBranch)</pre>
<div class="block">Attempt to merge a local and remote commit and commit the result to the specified branch.

 <p>
 The implementation in <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="class in org.dellroad.stuff.pobj.distrib"><code>Synchronizer</code></a> attempts to merge the files in an automated way
 using git's patience merge algorithm.

 <p>
 In case of conflicts, <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#chooseConflictWinner-java.lang.String-java.lang.String-"><code>chooseConflictWinner()</code></a>,
 <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#handleConflictOverride-java.lang.String-java.lang.String-java.lang.String-org.dellroad.stuff.pobj.distrib.MergeStrategy-"><code>handleConflictOverride()</code></a> and/or
 <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html#handleImpossibleMerge-java.lang.String-java.lang.String-java.lang.String-"><code>handleImpossibleMerge()</code></a> is invoked as appropriate.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>remote</code> - name of the remote being merged</dd>
<dd><code>localCommit</code> - local commit name (SHA-1 hash)</dd>
<dd><code>remoteCommit</code> - remote commit name (SHA-1 hash)</dd>
<dd><code>commitBranch</code> - branch to commit merged result to</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>commit name (SHA-1 hash) if the merge succeeded, null if the merge failed</dd>
</dl>
</li>
</ul>
<a name="chooseConflictWinner-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>chooseConflictWinner</h4>
<pre>protected&nbsp;boolean&nbsp;chooseConflictWinner(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commit1,
                                       <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;commit2)</pre>
<div class="block">Choose which commit should "win" in case there is a conflict between two commits.

 <p>
 It is imperative that this method <b>only</b> depend on information associated with the given commits.
 In particular, it must not depend on which node it is running on. This ensures that all nodes come
 to the same conclusion and therefore produce the same outcome when merging.

 <p>
 The implementation in <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="class in org.dellroad.stuff.pobj.distrib"><code>Synchronizer</code></a> chooses the commit with the later timestamp, or if both commits
 have the same timestamp, then the commit with the lexicographically higher SHA-1 checksum.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>commit1</code> - first commit ID</dd>
<dd><code>commit2</code> - second commit ID</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true if <code>commit1</code> should win, false if <code>commit2</code> should win</dd>
</dl>
</li>
</ul>
<a name="handleConflictOverride-java.lang.String-java.lang.String-java.lang.String-org.dellroad.stuff.pobj.distrib.MergeStrategy-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>handleConflictOverride</h4>
<pre>protected&nbsp;void&nbsp;handleConflictOverride(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remote,
                                      <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;localCommit,
                                      <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remoteCommit,
                                      <a href="../../../../../org/dellroad/stuff/pobj/distrib/MergeStrategy.html" title="enum in org.dellroad.stuff.pobj.distrib">MergeStrategy</a>&nbsp;strategy)</pre>
<div class="block">Handle a situation where some of our local changes were overridden due to merge conflicts, but
 in the end we were able to produce a valid root.

 <p>
 The implementation in <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="class in org.dellroad.stuff.pobj.distrib"><code>Synchronizer</code></a> just logs a warning message.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>remote</code> - name of the remote that overrode us</dd>
<dd><code>localCommit</code> - our commit in the merge</dd>
<dd><code>remoteCommit</code> - remote's commit in the merge</dd>
<dd><code>strategy</code> - the strategy that was used to resolve the conflict</dd>
</dl>
</li>
</ul>
<a name="handleImpossibleMerge-java.lang.String-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>handleImpossibleMerge</h4>
<pre>protected&nbsp;void&nbsp;handleImpossibleMerge(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remote,
                                     <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;localCommit,
                                     <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;remoteCommit)</pre>
<div class="block">Handle a situation where all of the merge strategies failed to produce a valid root object.
 This can only happen when a remote node has different validation criteria than we do, for example,
 it is running a different version of the application.

 <p>
 The implementation in <a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="class in org.dellroad.stuff.pobj.distrib"><code>Synchronizer</code></a> just logs a warning message.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>remote</code> - name of the remote that we are conflicting with</dd>
<dd><code>localCommit</code> - our commit in the merge</dd>
<dd><code>remoteCommit</code> - remote's commit in the merge</dd>
</dl>
</li>
</ul>
<a name="getXMLFile-java.io.File-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getXMLFile</h4>
<pre>protected&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;getXMLFile(<a href="http://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dir)</pre>
<div class="block">Get the XML file.

 <p>
 To avoid race conditions, the file should only be accessed from within a <a href="../../../../../org/dellroad/stuff/pobj/distrib/GitRepository.Accessor.html" title="interface in org.dellroad.stuff.pobj.distrib"><code>GitRepository.Accessor</code></a> callback.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>dir</code> - <code>git(1)</code> working directory root</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>persistent object XML file</dd>
</dl>
</li>
</ul>
<a name="readXMLFile-java.io.File-boolean-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>readXMLFile</h4>
<pre>protected&nbsp;<a href="../../../../../org/dellroad/stuff/pobj/distrib/Synchronizer.html" title="type parameter in Synchronizer">T</a>&nbsp;readXMLFile(<a href="http://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dir,
                        boolean&nbsp;validate)</pre>
<div class="block">Read and (optionally) validate the XML file.

 <p>
 To avoid race conditions, this method should only be invoked from within a <a href="../../../../../org/dellroad/stuff/pobj/distrib/GitRepository.Accessor.html" title="interface in org.dellroad.stuff.pobj.distrib"><code>GitRepository.Accessor</code></a> callback.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>dir</code> - <code>git(1)</code> working directory root</dd>
<dd><code>validate</code> - whether to also validate the file</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>decoded root object</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/Synchronizer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/dellroad/stuff/pobj/distrib/MergeStrategy.html" title="enum in org.dellroad.stuff.pobj.distrib"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li>Next&nbsp;Class</li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/dellroad/stuff/pobj/distrib/Synchronizer.html" target="_top">Frames</a></li>
<li><a href="Synchronizer.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2017. All rights reserved.</small></p>
</body>
</html>
